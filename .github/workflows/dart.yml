name: iOS-ipa-build
on:
  workflow_dispatch:  # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å inputs –¥–ª—è –≤–µ—Ä—Å–∏–∏/—Ç–µ–≥–∞

permissions:
  contents: write

jobs:
  build-ios:
    name: üéâ iOS Build
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - uses: subosito/flutter-action@v2
        with:
          channel: stable
          architecture: x64

      - run: flutter pub get

      - name: Install Pods
        run: pod install --repo-update  # repo-update –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
        working-directory: ios

      - name: Build IPA (recommended way)
        run: |
          flutter build ipa --release --no-codesign \
            --dart-define=OPEN_WEATHER_API_KEY=${{ secrets.OPEN_WEATHER_API_KEY }}

      # IPA –±—É–¥–µ—Ç –≤ build/ios/ipa/*.ipa (–æ–±—ã—á–Ω–æ –¢–≤–æ–µ–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.ipa)
      - name: Upload IPA to release
        uses: svenstaro/upload-release-action@v2
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: build/ios/ipa/*.ipa  # –∏–ª–∏ —Ç–æ—á–Ω—ã–π –ø—É—Ç—å, –µ—Å–ª–∏ –∑–Ω–∞–µ—à—å –∏–º—è
          asset_name: FlutterApp.ipa
          tag: v1.0  # –ò–ª–∏ —Å–¥–µ–ª–∞–π input: ${{ github.event.inputs.version }}
          overwrite: true
          body: 'New iOS release'
